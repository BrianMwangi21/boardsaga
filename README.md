# BoardSaga

Transform chess PGN files into captivating stories powered by AI.

## What It Does

Upload your chess games (PGN files) and get a generated story that brings your matches to life. BoardSaga analyzes your games and creates narratives that capture the drama, strategy, and memorable moments of each match.

**Key Features:**
- ğŸ¯ **Accurate Analysis**: Stockfish chess engine evaluates moves and identifies blunders, brilliancies, and tactical patterns
- ğŸ“– **Story Generation**: AI creates engaging narratives with chapters for opening, middlegame, and endgame
- ğŸ­ **Piece Personalities**: Each chess piece has unique lore and personality woven into stories
- â™Ÿï¸ **Chess Board Visualization**: Interactive board shows critical positions from your game
- ğŸ“š **Story History**: Browse and revisit all your generated stories
- âš ï¸ **AI Transparency**: Clear disclaimers about AI-generated content and mitigation strategies

## Tech Stack

- **Framework**: Next.js 15
- **Styling**: Tailwind CSS 4 (classic wood chess theme)
- **Database**: MongoDB Atlas
- **AI**: Vercel AI SDK with OpenRouter (open-source LLMs)
- **Chess Engine**: Stockfish.js (WebAssembly) for move analysis
- **Chess Library**: Chess.js for PGN parsing and move validation
- **Testing**: Jest with React Testing Library
- **Deployment**: Vercel

## Getting Started

### Prerequisites

- Node.js 20+ 
- MongoDB Atlas account (free tier works)
- OpenRouter API key (free tier available)

### Installation

1. Clone the repo:
```bash
git clone <your-repo-url>
cd boardsaga
```

2. Install dependencies:
```bash
npm install
```

3. Set up environment variables:
```bash
cp .env.example .env
# Add your OpenRouter API key to .env
# Add your MongoDB connection string to .env
```

4. Run the dev server:
```bash
npm run dev
```

Open [http://localhost:3000](http://localhost:3000) to see the app.

### Environment Variables

Required variables in `.env`:
```
OPENROUTER_API_KEY=your_openrouter_key
MONGODB_URI=mongodb+srv://...
```

## Project Structure

```
boardsaga/
â”œâ”€â”€ app/                      # Next.js app router pages and API routes
â”‚   â”œâ”€â”€ api/                  # API endpoints
â”‚   â”‚   â”œâ”€â”€ analyze-game/     # LLM game analysis
â”‚   â”‚   â”œâ”€â”€ generate-story/   # Story generation
â”‚   â”‚   â”œâ”€â”€ parse-pgn/        # PGN parsing
â”‚   â”‚   â””â”€â”€ stories/          # Story CRUD operations
â”‚   â”œâ”€â”€ components/           # React components
â”‚   â”‚   â”œâ”€â”€ chess/            # Chess board visualization
â”‚   â”‚   â”œâ”€â”€ pgn/              # PGN upload component
â”‚   â”‚   â”œâ”€â”€ story/            # Story viewer
â”‚   â”‚   â””â”€â”€ ui/               # Reusable UI components
â”‚   â”œâ”€â”€ lore/                 # Piece lore page
â”‚   â””â”€â”€ stories/              # Story history page
â”œâ”€â”€ lib/                      # Utilities and helpers
â”‚   â”œâ”€â”€ prompts/              # LLM prompts and piece lore (LORE.md)
â”‚   â”œâ”€â”€ __tests__/            # Test suites
â”‚   â”œâ”€â”€ constants.ts          # Named constants
â”‚   â”œâ”€â”€ db.ts                 # MongoDB connection
â”‚   â”œâ”€â”€ pgn-parser.ts         # Chess.js PGN parsing
â”‚   â”œâ”€â”€ stockfish-client.ts   # Stockfish engine wrapper
â”‚   â”œâ”€â”€ theme.ts              # Theme constants
â”‚   â””â”€â”€ utils.ts              # Shared utilities
â”œâ”€â”€ public/                   # Static assets
â”œâ”€â”€ .env.example              # Environment variables template
â”œâ”€â”€ AGENTS.md                 # Development guidelines for AI agents
â”œâ”€â”€ ROADMAP.md                # Development roadmap
â””â”€â”€ sessions/                 # Session tracking for development
```

## Piece Lore System

BoardSaga features a unique lore system that gives each chess piece its own personality and voice. Stories generated by BoardSaga incorporate these characteristics to create engaging narratives.

### The Pieces

- **â™™ Pawn**: Humble and ambitious, dreaming of promotion
- **â™œ Rook**: The unwavering guardian of territory
- **â™ Knight**: The unpredictable strategic trickster
- **â™ Bishop**: The spiritual guide with mystic insight
- **â™› Queen**: The sovereign commander with boundless power
- **â™š King**: The crown bearing the weight of the kingdom

Each piece has catch-phrases and personality traits that are woven into generated stories. For the complete lore reference, see [lib/prompts/LORE.md](./lib/prompts/LORE.md).

Visit `/lore` in the application to explore the full piece lore and world-building.

## AI & Accuracy

### Stockfish Engine Integration

BoardSaga uses the Stockfish chess engine to ensure move accuracy in generated stories:

- **Move Analysis**: Every move is evaluated with centipawn scores
- **Move Classifications**: Identifies blunders, mistakes, inaccuracies, good moves, and brilliancies
- **Tactical Detection**: Recognizes pins, forks, skewers, sacrifices, and checkmate sequences
- **Position Evaluation**: Evaluates key positions throughout the game

### AI Disclaimers

The application includes multiple AI disclaimers to maintain transparency:

1. **Footer**: General disclaimer on all pages
2. **Story Page**: Prominent warning box below each generated story
3. **Loading Screen**: Notice during story generation
4. **History Page**: Reminder when browsing stories

These disclaimers inform users that:
- Stories are AI-generated
- Stockfish engine ensures move accuracy
- AI can occasionally make mistakes
- Stories should be enjoyed as creative interpretations, not definitive analyses

## Testing

The project includes comprehensive test coverage:

```bash
npm test
```

**Test Coverage:**
- PGN parsing and validation (13 tests)
- Prompt generation (6 tests)
- Stockfish client move classification (9 tests)
- Story generation prompts (10 tests)
- API route validation (3 tests)

**Total: 41 tests passing** (87% coverage, some tests skipped due to Node.js environment limitations)

### Running Tests

```bash
# Run all tests
npm test

# Run tests in watch mode
npm test -- --watch

# Run tests with coverage
npm test -- --coverage
```

## Available Scripts

```bash
npm run dev          # Start development server
npm run build        # Build for production
npm run start        # Start production server
npm run test         # Run tests
npm run lint         # Run ESLint
```

## Development Phases (All Complete! âœ…)

**Phase 1: PGN Upload & Parsing** âœ…
- Drag-and-drop PGN upload
- PGN validation and error handling
- Chess.js integration for parsing

**Phase 2: LLM Integration** âœ…
- OpenRouter integration with streaming responses
- Comprehensive prompt system
- Piece lore integration
- Rate limiting and caching

**Phase 3: Story Generation** âœ…
- Multi-chapter story structure
- Creative loading experience
- Multiple story formats
- Chess board visualization

**Phase 4: Storage & Persistence** âœ…
- MongoDB Atlas integration
- Story CRUD operations
- PGN hash caching
- Story history page

**Phase 5: Chess-Themed UI** âœ…
- Classic wood chess theme
- Elegant typography (serif/sans-serif)
- Responsive design
- Smooth animations

**Phase 6: Stockfish Integration** âœ…
- Client-side Stockfish.js
- Move evaluation and classification
- Tactical pattern detection
- AI hallucination mitigation

See [ROADMAP.md](./ROADMAP.md) for detailed phase information.

## Contributing

This is a hobby project built with love for chess. Feel free to open issues or PRs!

### Development Guidelines

See [AGENTS.md](./AGENTS.md) for:
- Component design principles
- Function design patterns
- File organization
- Code style guidelines
- Testing strategy

## Future Enhancements

While the MVP is complete, potential future features include:

- User authentication and accounts
- Social features (share stories, comments)
- Interactive board replay alongside story
- Multi-language support
- Export stories (PDF, EPUB)
- Community story gallery
- Mobile app

## License

MIT

---

**Built with â¤ï¸  for chess enthusiasts**
